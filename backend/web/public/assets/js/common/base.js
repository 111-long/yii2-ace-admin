var oLoading=null;function alwaysClose(){layer.close(oLoading)}function ajaxFail(){return layer.msg("服务器繁忙,请稍候再试...",{time:1000,icon:2})}function empty(val){return val==undefined||val==""}function in_array(val,arr){for(var i in arr){if(arr[i]===val){return true}}return false}function ucfirst(str){return str.substr(0,1).toUpperCase()+str.substr(1)}function handleParams(params,prefix){var other="";prefix=prefix?prefix:"";if(params!=undefined&&typeof params=="object"){for(var i in params){other+=" "+i+'="'+prefix+params[i]+'" '}}return other}function Label(content,params){return"<label "+handleParams(params)+"> "+content+" </label>"}function createInput(params,type){return'<input type="'+type+'" '+handleParams(params)+" />"}function createPassword(params){return createInput(params,"password")}function createText(params){return createInput(params,"text")}function createTextarea(params){if(empty(params)){params={"class":" form-control","rows":5}}return"<textarea "+handleParams(params)+"></textarea>"}function createDiv(params){return"<div "+handleParams(params)+"></div>"}function createRadio(params,data,checked){var html="";params=handleParams(params);if(data!=undefined&&typeof data=="object"){for(var i in data){var check=checked==i?' checked="checked" ':"";html+='<label class="line-height-1 blue"> <input type="radio" '+params+check+' value="'+i+'"  /> <span class="lbl"> '+data[i]+" </span> </label>　 "}}return html}function createSelect(params,data,selected){var html="";params=handleParams(params);if(data!=undefined&&typeof data=="object"){html+="<select "+params+">";for(var i in data){var select=i==selected?' selected="selected" ':"";html+='<option value="'+i+'" '+select+" >"+data[i]+"</option>"}html+="</select>"}return html}function createFile(params){var html="";if(params.options&&params.options.type){html='<input type="file" '+handleParams(params)+"/>"}else{html='<input type="hidden" name="'+params.name+'"/>';params["input-name"]=params.name;params.name=empty(params["file-name"])?"UploadForm["+params.name+"]":params["file-name"];html+='<input type="file" '+handleParams(params)+"/>"}return html}function createDate(params){return'<div class="input-group bootstrap-datepicker">         <input class="form-control date-picker me-date"  type="text" '+handleParams(params)+'/>         <span class="input-group-addon"><i class="fa fa-calendar bigger-110"></i></span>         </div>'}function createTime(params){return'<div class="input-group bootstrap-timepicker">         <input type="text" class="form-control time-picker" '+handleParams(params)+'/>         <span class="input-group-addon"><i class="fa fa-clock-o bigger-110"></i></span>         </div>'}function createDatetime(params){return'<div class="input-group bootstrap-datetimepicker">         <input type="text" class="form-control datetime-picker" '+handleParams(params)+'/>         <span class="input-group-addon"><i class="fa fa-clock-o bigger-110"></i></span>         </div>'}function createTimerange(params){return'<div class="input-daterange input-group">         <input type="text" class="input-sm form-control" name="start" />         <span class="input-group-addon"><i class="fa fa-exchange"></i></span>         <input type="text" class="input-sm form-control" name="end" />         </div>'}function createDaterange(params){return'<div class="input-group">         <span class="input-group-addon"><i class="fa fa-calendar bigger-110"></i></span>         <input class="form-control daterange-picker me-daterange" type="text" '+handleParams(params)+" />         </div>"}function createCheckbox(params,data,checked,arr,isHave){if(arr==undefined){arr="col-xs-6"}var html="";params=handleParams(params);console.info(params);if(data!=undefined&&typeof data=="object"){if(isHave==undefined){html+='<div class="checkbox col-xs-12"><label><input type="checkbox" class="ace checkbox-all" onclick="var isChecked = $(this).prop(\'checked\');$(this).parent().parent().parent().find(\'input[type=checkbox]\').prop(\'checked\', isChecked);"  /><span class="lbl"> 选择全部 </span></label></div>'}for(var i in data){html+='<div class="checkbox '+arr+'"><label><input type="checkbox" '+params+' value="'+i+'" /><span class="lbl"> '+data[i]+" </span></label></div>"}}return html}function createButtons(data){var div1='<div class="hidden-sm hidden-xs btn-group">',div2='<div class="hidden-md hidden-lg"><div class="inline position-relative"><button data-position="auto" data-toggle="dropdown" class="btn btn-minier btn-primary dropdown-toggle"><i class="ace-icon fa fa-cog icon-only bigger-110"></i></button><ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">';if(data!=undefined&&typeof data=="object"){for(var i in data){div1+=' <button class="btn '+data[i]["className"]+" "+data[i]["cClass"]+' btn-xs" table-data="'+data[i]["data"]+'"><i class="ace-icon fa '+data[i]["icon"]+' bigger-120"></i></button> ';div2+='<li><a title="'+data[i]["title"]+'" data-rel="tooltip" class="tooltip-info '+data[i]["cClass"]+'" href="javascript:;" data-original-title="'+data[i]["title"]+'" table-data="'+data[i]["data"]+'"><span class="'+data[i]["sClass"]+'"><i class="ace-icon fa '+data[i]["icon"]+' bigger-120"></i></span></a></li>'
}}return div1+"</div>"+div2+"</ul></div></div>"}function createViewTr(title,data){return'<tr><td width="25%">'+title+'</td><td class="views-info data-info-'+data+'"></td></tr>'}function createSearchForm(k,v){k.search.options=$.extend({"name":k.sName,"vid":v,"class":"me-search"},k.search.options);if(k.search.type=="select"){k.value["All"]="全部"}var html=window["create"+ucfirst(k.search.type)](k.search.options,k.value,"All");if(k.search.type=="select"){delete k.value["All"]}return Label(k.title+" : "+html)+" "}function createModal(oModal,oViews){return'<div class="isHide" '+handleParams(oViews["params"])+"> "+oViews["html"]+' </table></div>             <div class="modal fade '+(oModal["modalClass"]?oModal["modalClass"]:"")+'" '+handleParams(oModal["params"])+' tabindex="-1" role="dialog" >                 <div class="modal-dialog '+(oModal["modalDialogClass"]?oModal["modalDialogClass"]:"")+'" role="document">                     <div class="modal-content">                         <div class="modal-header">                             <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                             <h4 class="modal-title"> 编 辑 </h4>                         </div>                         <div class="modal-body">'+oModal["html"]+'</fieldset></form></div>                         <div class="modal-footer">                             <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>                             <button type="button" class="btn btn-primary btn-image '+oModal["bClass"]+'">确定</button>                         </div>                     </div>                 </div>             </div>'}function validateFile(info){var error=[];if(info&&typeof info=="object"){if(info.error_count["ext"]||info.error_count["mime"]){error.push("上传文件类型错误")}if(info.error_count["size"]){error.push("上传文件过大")}}return error.join(";")}function viewTable(object,data,tClass,row){object.forEach(function(k){var tmpKey=k.data,tmpValue=data[tmpKey],dataInfo=$(tClass+tmpKey);if(k.edit!=undefined&&k.edit.type=="password"){tmpValue="******"}(k.createdCell!=undefined&&typeof k.createdCell=="function")?k.createdCell(dataInfo,tmpValue,data,row,undefined):dataInfo.html(tmpValue)})}function handleMenuActive(strUrl){$("ul.nav-list a[href="+strUrl+"]").closest("li").addClass("active").parentsUntil("ul.nav-list").addClass("active open")}Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,(RegExp.$1.length==1)?(o[k]):(("00"+o[k]).substr((""+o[k]).length)))}}return fmt};function timeFormat(time,str){if(empty(str)){str="yyyy-MM-dd"}var date=new Date(time*1000);return date.Format(str)}function InitForm(select,data){objForm=$(select).get(0);if(objForm!=undefined){$(objForm).find("input[type=hidden]").val("");$(objForm).find("input[type=checkbox]").each(function(){$(this).attr("checked",false);if($(this).get(0)){$(this).get(0).checked=false}});objForm.reset();if(data!=undefined){for(var i in data){if(typeof data[i]=="object"){for(var x in data[i]){var key=i+"["+x+"]";if(objForm[key]!=undefined){objForm[key].value=data[i][x]}else{if(parseInt(data[i][x])>0){$("input[type=checkbox][name="+i+"\\[\\]][value="+data[i][x]+"]").attr("checked",true).each(function(){this.checked=true})}}}}if(objForm[i]!=undefined&&objForm[i].type!="password"){var obj=$(objForm[i]),tmp=data[i];if(obj.hasClass("time-format")){tmp=timeFormat(parseInt(tmp),obj.attr("time-format")?obj.attr("time-format"):"yyyy-MM-dd hh:mm:ss")}objForm[i].value=tmp}}}}}function aceFileInputAjax(file_input,url){var $form=file_input.closest("form"),files=file_input.data("ace_input_files"),deferred=new $.Deferred;if(!files||files.length==0){deferred.resolve();return deferred.promise()}if("FormData" in window){formData_object=new FormData();$.each($form.serializeArray(),function(i,item){formData_object.append(item.name,item.value)});formData_object.append(file_input.attr("name"),files[0]);file_input.ace_file_input("loading",true);deferred=$.ajax({url:url,type:"Post",processData:false,contentType:false,dataType:"json",data:formData_object,})}else{var temporary_iframe_id="temporary-iframe-"+(new Date()).getTime()+"-"+(parseInt(Math.random()*1000));var temp_iframe=$('<iframe id="'+temporary_iframe_id+'" name="'+temporary_iframe_id+'" 								frameborder="0" width="0" height="0" src="about:blank"								style="position:absolute; z-index:-1; visibility: hidden;"></iframe>').insertAfter($form);$form.append('<input type="hidden" name="temporary-iframe-id" value="'+temporary_iframe_id+'" />');temp_iframe.data("deferrer",deferred);$form.attr({method:"POST",enctype:"multipart/form-data",target:temporary_iframe_id});
    file_input.ace_file_input("loading",true);$form.get(0).submit();ie_timeout=setTimeout(function(){ie_timeout=null;temp_iframe.attr("src","about:blank").remove();deferred.reject({"status":"fail","message":"Timeout!"})},30000)}return deferred}function aceFileUpload(select,sFileUploadUrl){var $input=$(select),$file=$("input[type=hidden][name="+$input.attr("input-name")+"]"),allowExt=$input.attr("allowExt")?$input.attr("allowExt").split(","):null,allowMime=$input.attr("allowMime")?$input.attr("allowMime").split(","):null,maxSize=parseInt($input.attr("maxSize")),denyExt=$input.attr("denyExt")?$input.attr("denyExt").split(","):null,ie_timeout=null,aParams={allowExt:allowExt?allowExt:["jpg","jpeg","png","gif"],maxSize:maxSize?maxSize:200000000,denyExt:denyExt?denyExt:["exe","php"]};if(allowMime){aParams["allowMime"]=allowMime}var oOther={};if($input.attr("input-type")=="ace_file"){oOther={no_file:"没有选择文件 ...",btn_choose:"选择",btn_change:"更换文件",droppable:false,thumbnail:false}}else{oOther={style:"well",btn_choose:"单击此处删除文件或单击“选择”",btn_change:null,no_icon:"ace-icon fa fa-cloud-upload",droppable:true,thumbnail:"small"}}aParams=$.extend(aParams,oOther);aParams["before_remove"]=function(){if($file.val()){$.post(sFileUploadUrl,{"face":$file.val()})}$file.val("");return true};$input.ace_file_input(aParams).on("change",function(){var deferred=aceFileInputAjax($input,sFileUploadUrl+"?sField="+$input.attr("input-name"));deferred.done(function(json){if(json.errCode==0){layer.msg("上传文件的地址为："+json.data.sFilePath,{icon:6});$file.val(json.data.sFilePath)}else{layer.msg("上传文件出现错误Error:"+json.errMsg,{icon:5});$input.ace_file_input("apply_settings").ace_file_input("reset_input")}}).fail(function(){ajaxFail()}).always(function(){if(ie_timeout){clearTimeout(ie_timeout)}ie_timeout=null;$input.ace_file_input("loading",false)});deferred.promise()}).on("file.error.ace",function(event,info){layer.msg("文件上传出现错误："+validateFile(info),{icon:5});event.preventDefault()})}function createForm(k,oParams){var form="";if(!oParams.index){oParams.index=0}if(k.edit.options==undefined){k.edit.options={}}if(!k.edit.type){k.edit.type="text"}k.edit.options["name"]=k.sName;k.edit.options["class"]="form-control "+(k.edit.options["class"]?k.edit.options["class"]:"");if(k.edit.type==undefined){k.edit.type="text"}if(k.edit.type=="hidden"){form+=createInput(k.edit.options,"hidden")}else{if(oParams.iMultiCols>1&&!oParams.aCols){oParams.aCols=[];var iLength=Math.ceil(12/oParams.iMultiCols);oParams.aCols[0]=Math.floor(iLength*0.3);oParams.aCols[1]=iLength-oParams.aCols[0]}if(!oParams.bMultiCols||(oParams.iColsLength>1&&oParams.index%oParams.iColsLength==0)){form+='<div class="form-group">'}form+=Label(k.title,{"class":"col-sm-"+oParams.aCols[0]+" control-label"});form+='<div class="col-sm-'+oParams.aCols[1]+'">';if(k.edit.type=="radio"){k.edit.options["class"]="ace valid"}if(k.edit.type=="checkbox"){k.edit.options["class"]="ace m-checkbox";k.edit.options["name"]=k.sName+"[]"}if(k.edit.type=="text"){if(!empty(k.value)){k.edit.options["value"]=k.value}}form += window['create' + ucfirst(k.edit.type)](k.edit.options, k.value, k.edit.default);form+="</div>";if(!oParams.bMultiCols||(oParams.iColsLength>1&&oParams.index%oParams.iColsLength==(oParams.iColsLength-1))){form+="</div>"}oParams.index++}return form};